pipeline {
	agent any
	properties([
       parameters([
            string(name: 'VERSION', defaultValue: "1.0.0", description: 'The artifact version')
       ])
    ])
	stages {
		stage('clean dir') {
			steps {
				deleteDir() /* clean up our workspace */
			}
		}
        stage('Checkout projoject') {
            steps {
                git branch: '*/main',
                url: 'git@github.com:ittiel/fyber-consul-service.git'
               }
        }

		stage('Unit test') {
			steps {
				sh"""
				    mvn clean test
				"""
			}
		}

		stage('Build jar') {
            steps {
                sh"""
                    mvn package  -DskipTests=true
                """
            }
        }

        stage('Build Docker') {
            steps {
                sh"""
                    docker build -t ittiel/fyber-consul-service:${VERSION} .
                """
            }
        }

        stage('Deploy to registy') {
            steps {
                echo "Deploying artifact to Docker registry"
            }
        }
	}
}